<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bingo Player</title>
<style>
#board { display:grid; grid-template-columns:repeat(5,60px); gap:5px; margin-top:10px; }
.cell { width:60px; height:60px; display:flex; justify-content:center; align-items:center; font-weight:bold; border:1px solid #333; }
.marked { background-color: green; color:white; }
</style>
</head>
<body>
<h1>Stanislas' Bingo</h1>
<h2>Bingo Player</h2>
<label>Name: <input id="name" placeholder="Enter your name"></label>
<button id="b" onclick="join()">Join Game</button>
<div id="board"></div>
<div>Last number called: <span id="lastNumber">None</span></div>

<div id="calledNumbers"></div>
<hr>
<h3>Global Chat</h3>
<div id="chat" style="height:150px;overflow:auto;border:1px solid #333;padding:5px;"></div>
<input id="chatInput" placeholder="Type message..." style="width:80%">
<button onclick="sendChat()">Send</button>


<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io("https://server.ctksystem.com")
let board = []

function join(){
  const name = document.getElementById("name").value || "Anonymous"
  socket.emit("join", name)
}

socket.on("board", b=>{
  board = b
  renderBoard()
  document.getElementById("b").setAttribute("disabled", "")
})

socket.on("called_numbers", nums=>{
  nums.forEach(n=>markNumber(n))
})

socket.on("number_called", n=>{
  markNumber(n)
  document.getElementById("lastNumber").textContent = n // show last number
})

socket.on("bingo", ()=>alert("Bingo!"))

socket.on("game_ended", ()=>{
  alert("WARNING:\nClient disconnected:\nGame ended")
  document.getElementById("b").removeAttribute("disabled")
  board=[]
  renderBoard()
})

socket.on("kicked", ()=>{
  alert("WARNING!\nClient disconnected with an error:\n\nMODERATION: Kicked by administrator.")
  socket.disconnect()
  document.getElementById("board").innerHTML = ""
  document.getElementById("b").removeAttribute("disabled")
})

  
socket.on("error_msg", msg=>alert("WARNING!\nClient disconnected with an error:\n\nThe CTK Server has disconnected you because of an error, you are currently trying to reconnect. Error: " + msg))

function renderBoard(){
  const div = document.getElementById("board")
  div.innerHTML=""
  board.forEach((val,i)=>{
    const cell = document.createElement("div")
    cell.className="cell"
    cell.textContent=val
    if(val==="FREE") cell.classList.add("marked")
    cell.id="cell_"+i
    div.appendChild(cell)
  })
}

function markNumber(n){
  const idx = board.findIndex(v=>v===n)
  if(idx===-1) return
  board[idx]=n
  const c = document.getElementById("cell_"+idx)
  if(c) c.classList.add("marked")
}

function sendChat(){
  const input = document.getElementById("chatInput")
  if(!input.value.trim()) return

  socket.emit("global_message", {
    name: document.getElementById("name").value || "Anonymous",
    message: input.value
  })

  input.value = ""
}

socket.on("global_message", data=>{
  const chat = document.getElementById("chat")
  const div = document.createElement("div")
  div.textContent = `${data.from}: ${data.message}`
  chat.appendChild(div)
  chat.scrollTop = chat.scrollHeight
})

// Admin private message
socket.on("private_message", data=>{
  alert(`PRIVATE MESSAGE FROM ${data.from}:\n\n${data.message}`)
})

</script>
</body>
</html>
